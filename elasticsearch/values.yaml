## Bitnami Elasticsearch Legacy Configuration
## Optimized for Rancher Desktop (Local)

global:
  imageRegistry: docker.io
  storageClass: "local-path" # Matches Rancher Desktop default

## 1. Main Elasticsearch Image
image:
  repository: bitnamilegacy/elasticsearch
  tag: 7.17.10
  pullPolicy: IfNotPresent

## 2. Sysctl Init Container Fix
## Points to Legacy to avoid "Manifest Unknown" from the main Bitnami repo
sysctl:
  enabled: true
  image:
    repository: bitnamilegacy/os-shell
    tag: 11-debian-11-r94
  # Using sh -c is more reliable across different shell images
  command:
    - /bin/sh
    - -c
    - |
      sysctl -w vm.max_map_count=262144
      sysctl -w fs.file-max=65536

## 3. Resource & Role Optimization
## This combines everything into 1 pod to save Mac RAM
master:
  replicaCount: 1
  persistence:
    size: 5Gi
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 1000m
      memory: 2Gi
  heapSize: 1024m

# Disable separate data/ingest/coordinating nodes for local dev
data:
  replicaCount: 0
coordinating:
  replicaCount: 0
ingest:
  replicaCount: 0

## 4. Security Context (Bitnami 1001 standard)
podSecurityContext:
  fsGroup: 1001
containerSecurityContext:
  runAsUser: 1001